<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handling data with unclean column names • r2dii.utils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Handling data with unclean column names">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2dii.utils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/handling-unclean-data.html">Handling data with unclean column names</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maurolepore/">
    <span class="fa fa-gavel"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/2DegreesInvesting/r2dii.utils/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://2degreesinvesting.github.io/r2dii/index.html">r2dii</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Handling data with unclean column names</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/2DegreesInvesting/r2dii.utils/blob/master/vignettes/handling-unclean-data.Rmd"><code>vignettes/handling-unclean-data.Rmd</code></a></small>
      <div class="hidden name"><code>handling-unclean-data.Rmd</code></div>

    </div>

    
    
<div id="tldr" class="section level3">
<h3 class="hasAnchor">
<a href="#tldr" class="anchor"></a>tl;dr</h3>
<p>Too long; didn’t read?</p>
<p>Use this example to write functions for data with clean column names (<code>like_this</code>) or any unclean version (<code>likeThis</code> and <code>like.this</code>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr))</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rlang)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(r2dii.utils)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...) {</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="co"># 1. First, clean data and groups (if any).</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(data)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  dots &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_quo.html">clean_quo</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">enquos</a></span>(...))</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="co"># 2. Ensure `data` has all the clean names that your data uses</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw"><a href="../reference/check_crucial_names.html">check_crucial_names</a></span>(clean, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x_x"</span>, <span class="kw"><a href="../reference/quo_chr.html">quo_chr</a></span>(dots)))</span>
<span id="cb1-12"><a href="#cb1-12"></a>  </span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="co"># 2. Then, write your code.</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="op">!!!</span><span class="st"> </span>dots) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="st">    </span><span class="co"># If you have to hard-wire column names, always use snake_style.</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(x_x)</span>
<span id="cb1-18"><a href="#cb1-18"></a>  </span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="co"># 3. Last, restore the unclean column names of the original data.</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  result <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st">    </span><span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(data)</span>
<span id="cb1-22"><a href="#cb1-22"></a>}</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co"># EXAMPLES </span></span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co"># snake_stye</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="kw">f</span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">x_x =</span> <span class="dv">1</span>, <span class="dt">y_y =</span> <span class="dv">1</span>), x_x)</span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; # A tibble: 1 x 1</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">#&gt; # Groups:   x_x [1]</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#&gt;     x_x</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#&gt; 1     1</span></span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co"># dot.style</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="kw">f</span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">x.x =</span> <span class="dv">1</span>, <span class="dt">y.y =</span> <span class="dv">1</span>), x.x)</span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co">#&gt; # A tibble: 1 x 1</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">#&gt; # Groups:   x.x [1]</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">#&gt;     x.x</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">#&gt; 1     1</span></span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co"># cammelStyle</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="kw">f</span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">xX =</span> <span class="dv">1</span>, <span class="dt">yY =</span> <span class="dv">1</span>), xX)</span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">#&gt; # A tibble: 1 x 1</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">#&gt; # Groups:   xX [1]</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">#&gt;      xX</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co">#&gt; 1     1</span></span>
<span id="cb1-49"><a href="#cb1-49"></a></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co"># Fails: Clean version of the given name isn't the hard-wired clean name</span></span>
<span id="cb1-51"><a href="#cb1-51"></a>bad &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">x.x.x =</span> <span class="dv">1</span>)</span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(bad))</span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">#&gt; [1] "x_x_x"</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(<span class="kw">f</span>(bad, x.x.x))</span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co">#&gt; Error : Must have missing names:</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="co">#&gt; x_x</span></span></code></pre></div>
<p>If your function takes a single group via a named argument (not <code>...</code>), capture it with <code><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">enquo()</a></code> (not <code><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">enquos()</a></code>) and unquote it with <code>!!</code> or <code>{{</code> (not <code>!!!</code>).</p>
</div>
<div id="details" class="section level3">
<h3 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; </span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; The following objects are masked from 'package:rlang':</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;     %@%, as_function, flatten, flatten_chr, flatten_dbl, flatten_int,</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;     flatten_lgl, flatten_raw, invoke, list_along, modify, prepend,</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;     splice</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rlang)</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(r2dii.utils)</span></code></pre></div>
<p>Data with unclean column names is difficult to work with. Sooner or later you’ll forget if a column you need is typed <code>LikeThis</code>, <code>likeThis</code>, <code>Like.This</code> or <code>like.This</code>. Luckily, all of those forms can be cleaned in a unique way with <code><a href="https://rdrr.io/pkg/janitor/man/make_clean_names.html">janitor::make_clean_names()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>unclean &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="st">"LikeThis"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="st">"likeThis"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="st">"Like.This"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="st">"like.This"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>unclean <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(janitor<span class="op">::</span>make_clean_names)</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; [1] "like_this" "like_this" "like_this" "like_this"</span></span></code></pre></div>
<p>And now you can work with a clean column name <code>like_this</code>.</p>
<p>Your code will be more maintainable if you always write code for clean names. But <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names()</a></code> seems to lack support for groups, or a way to restore unclean column names and groups so that you clean up after yourself and leave the data as you found it. r2dii.utils has a family of functions dedicated to solving that problem:</p>
<ul>
<li>
<code><a href="../reference/clean_column_names.html">clean_column_names()</a></code> is similar to <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names()</a></code>.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>unclean &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">x.x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">y.y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(unclean)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;     x_x   y_y</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; 1     1     1</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; 2     1     2</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; 3     2     3</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; 4     2     4</span></span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>janitor<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span>(unclean)</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;     x_x   y_y</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; 1     1     1</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 2     1     2</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; 3     2     3</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; 4     2     4</span></span></code></pre></div>
<p>But <code><a href="../reference/clean_column_names.html">clean_column_names()</a></code> also cleans dplyr groups; <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names()</a></code> doesn’t.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>unclean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(x.x) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span>janitor<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; # Groups:   x.x [2]</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;     x_x   y_y</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; 1     1     1</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; 2     1     2</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; 3     2     3</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; 4     2     4</span></span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>clean &lt;-<span class="st"> </span>unclean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(x.x) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="st">  </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>()</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>clean</span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt; # Groups:   x_x [2]</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt;     x_x   y_y</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt; 1     1     1</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt; 2     1     2</span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt; 3     2     3</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co">#&gt; 4     2     4</span></span></code></pre></div>
<p>Now you can work comfortably with clean column names such as <code>x_x</code> and <code>y_y</code> instead of unclean column names such as <code>x.x</code> or <code>y.y</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_y))</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>result</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; # Groups:   x_x [2]</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;     x_x   y_y total</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; 1     1     1     3</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 2     1     2     3</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 3     2     3     7</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 4     2     4     7</span></span></code></pre></div>
<p><code><a href="../reference/unclean_column_names.html">unclean_column_names()</a></code> helps you restore the original, unclean column names – so you leave the data as close as possible to how you found it.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(result, unclean)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; # Groups:   x.x [2]</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt;     x.x   y.y total</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; 1     1     1     3</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; 2     1     2     3</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; 3     2     3     7</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; 4     2     4     7</span></span></code></pre></div>
<p>This becomes important when you write functions. If you can’t force your users to input clean data, you can clean it yourself, do what you mean to do, then restore the unclean names and return.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>sum_y &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(data)</span>
<span id="cb8-3"><a href="#cb8-3"></a>  </span>
<span id="cb8-4"><a href="#cb8-4"></a>  result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_y))</span>
<span id="cb8-6"><a href="#cb8-6"></a>  </span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(result, data)</span>
<span id="cb8-8"><a href="#cb8-8"></a>}</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="kw">sum_y</span>(unclean)</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;     x.x   y.y total</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; 1     1     1    10</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; 2     1     2    10</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt; 3     2     3    10</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt; 4     2     4    10</span></span></code></pre></div>
</div>
<div id="handling-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#handling-groups" class="anchor"></a>Handling groups</h3>
<p>If you functions take groups, you need to clean them too. Here is how:</p>
<ul>
<li>For one group passed as a string, clean it with <code><a href="https://rdrr.io/pkg/janitor/man/make_clean_names.html">janitor::make_clean_names()</a></code>:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>sum_y &lt;-<span class="st"> </span><span class="cf">function</span>(data, by) {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(data)</span>
<span id="cb9-3"><a href="#cb9-3"></a>  by &lt;-<span class="st"> </span>janitor<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/janitor/man/make_clean_names.html">make_clean_names</a></span>(by)</span>
<span id="cb9-4"><a href="#cb9-4"></a>  </span>
<span id="cb9-5"><a href="#cb9-5"></a>  result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(.data[[by]]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_y))</span>
<span id="cb9-8"><a href="#cb9-8"></a>  </span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(result, data)</span>
<span id="cb9-10"><a href="#cb9-10"></a>}</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="kw">sum_y</span>(unclean, <span class="dt">by =</span> <span class="st">"x.x"</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; # Groups:   x.x [2]</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt;     x.x   y.y total</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt; 1     1     1     3</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt; 2     1     2     3</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt; 3     2     3     7</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt; 4     2     4     7</span></span></code></pre></div>
<ul>
<li>For one group passed as a symbol, you’ll need to capture it with <code><a href="https://rlang.r-lib.org/reference/nse-defuse.html">rlang::enquo()</a></code>, then clean it with <code><a href="../reference/clean_quo.html">clean_quo()</a></code> and unquote it with either bang bang <code>!!</code> or embrace <code>{{</code>:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>sum_y &lt;-<span class="st"> </span><span class="cf">function</span>(data, by) {</span>
<span id="cb10-2"><a href="#cb10-2"></a>  clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(data)</span>
<span id="cb10-3"><a href="#cb10-3"></a>  by &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_quo.html">clean_quo</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">enquo</a></span>(by))</span>
<span id="cb10-4"><a href="#cb10-4"></a>  </span>
<span id="cb10-5"><a href="#cb10-5"></a>  result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">    </span><span class="co"># You can also use `group_by(!!by)`</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>({{ by }}) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_y))</span>
<span id="cb10-9"><a href="#cb10-9"></a>  </span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(result, data)</span>
<span id="cb10-11"><a href="#cb10-11"></a>}</span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="kw">sum_y</span>(unclean, <span class="dt">by =</span> x.x)</span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; # Groups:   x.x [2]</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt;     x.x   y.y total</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; 1     1     1     3</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt; 2     1     2     3</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">#&gt; 3     2     3     7</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">#&gt; 4     2     4     7</span></span></code></pre></div>
<ul>
<li>And for multiple groups passed via <code>...</code>, you’ll need to capture them with <code><a href="https://rlang.r-lib.org/reference/nse-defuse.html">rlang::enquos()</a></code>, then clean them with <code><a href="../reference/clean_quo.html">clean_quo()</a></code> and unquote-splice it with big bang <code>!!!</code>:</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>sum_y &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...) {</span>
<span id="cb11-2"><a href="#cb11-2"></a>  clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_column_names.html">clean_column_names</a></span>(data)</span>
<span id="cb11-3"><a href="#cb11-3"></a>  by &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_quo.html">clean_quo</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">enquos</a></span>(...))</span>
<span id="cb11-4"><a href="#cb11-4"></a>  </span>
<span id="cb11-5"><a href="#cb11-5"></a>  result &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="op">!!!</span>by) <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_y))</span>
<span id="cb11-8"><a href="#cb11-8"></a>  </span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="kw"><a href="../reference/unclean_column_names.html">unclean_column_names</a></span>(result, data)</span>
<span id="cb11-10"><a href="#cb11-10"></a>}</span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="kw">sum_y</span>(unclean, x.x, y.y)</span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; # Groups:   x.x, y.y [4]</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt;     x.x   y.y total</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt; 1     1     1     1</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">#&gt; 2     1     2     2</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#&gt; 3     2     3     3</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">#&gt; 4     2     4     4</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/maurolepore/">Mauro Lepore</a>, <a href="https://2degrees-investing.org/">2 Degrees Investing Initiative</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
